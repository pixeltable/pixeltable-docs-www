---
title: "Working with Voyage AI in Pixeltable"
icon: "notebook"
---
<a href="https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/notebooks/integrations/working-with-voyageai.ipynb" id="openKaggle" target="_blank" rel="noopener noreferrer"><img src="https://kaggle.com/static/images/open-in-kaggle.svg" alt="Open in Kaggle" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/notebooks/integrations/working-with-voyageai.ipynb" id="openColab" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/refs/tags/release/docs/notebooks/integrations/working-with-voyageai.ipynb" id="downloadNotebook" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook" style={{ display: 'inline', margin: '0px' }} noZoom /></a>

<Tip>This documentation page is also available as an interactive notebook. You can launch the notebook in
Kaggle or Colab, or download it for use with an IDE or local Jupyter installation, by clicking one of the
above links.</Tip>




export const quartoRawHtml =
[`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">text</th>
<th data-quarto-table-cell-role="th">embedding</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">The Mediterranean diet emphasizes fish, olive oil, and vegetables,
believed to reduce chronic diseases.</td>
<td style="vertical-align: middle;">[ 0.048 0.016 0.002 0.026 0.038 0.013 ... -0.015 -0.034 -0.016 0.007
0.046 -0.011]</td>
</tr>
<tr>
<td style="vertical-align: middle;">Photosynthesis in plants converts light energy into glucose and
produces essential oxygen.</td>
<td style="vertical-align: middle;">[ 0.013 0.023 -0.004 0.052 0.037 0.022 ... -0.013 -0.042 0.001 0.008
-0.02 -0.016]</td>
</tr>
<tr>
<td style="vertical-align: middle;">20th-century innovations, from radios to smartphones, centered on
electronic advancements.</td>
<td style="vertical-align: middle;">[ 4.373e-03 4.474e-02 -6.796e-05 2.745e-02 4.904e-02 6.148e-03 ...
-1.833e-02 -4.274e-02 -4.713e-03 -1.739e-02 -1.540e-03 -2.306e-02]</td>
</tr>
</tbody>
</table>
`,`<style type="text/css">
#T_b82a8 th {
  text-align: left;
}
#T_b82a8_row0_col0, #T_b82a8_row0_col1, #T_b82a8_row0_col2, #T_b82a8_row1_col0, #T_b82a8_row1_col1, #T_b82a8_row1_col2 {
  white-space: pre-wrap;
  text-align: left;
}
</style>
`,`
<table id="T_b82a8" data-quarto-postprocess="true">
<thead>
<tr>
<th id="T_b82a8_level0_col0" class="col_heading level0 col0"
data-quarto-table-cell-role="th">Name</th>
<th id="T_b82a8_level0_col1" class="col_heading level0 col1"
data-quarto-table-cell-role="th">Type</th>
<th id="T_b82a8_level0_col2" class="col_heading level0 col2"
data-quarto-table-cell-role="th">Expression</th>
</tr>
</thead>
<tbody>
<tr>
<td id="T_b82a8_row0_col0" class="data row0 col0">text</td>
<td id="T_b82a8_row0_col1" class="data row0 col1">String</td>
<td id="T_b82a8_row0_col2" class="data row0 col2">text</td>
</tr>
<tr>
<td id="T_b82a8_row1_col0" class="data row1 col0">score</td>
<td id="T_b82a8_row1_col1" class="data row1 col1">Required[Float]</td>
<td id="T_b82a8_row1_col2" class="data row1 col2">text.similarity('What
are the health benefits of Mediterranean food?')</td>
</tr>
</tbody>
</table>
`,`
<style type="text/css">
#T_9ce1b th {
  text-align: left;
}
#T_9ce1b_row0_col0, #T_9ce1b_row1_col0, #T_9ce1b_row2_col0 {
  white-space: pre-wrap;
  text-align: left;
}
</style>
`,`
<table id="T_9ce1b" data-quarto-postprocess="true">
<tbody>
<tr>
<td id="T_9ce1b_level0_row0" class="row_heading level0 row0"
data-quarto-table-cell-role="th">From</td>
<td id="T_9ce1b_row0_col0" class="data row0 col0">search</td>
</tr>
<tr>
<td id="T_9ce1b_level0_row1" class="row_heading level0 row1"
data-quarto-table-cell-role="th">Order By</td>
<td id="T_9ce1b_row1_col0" class="data row1 col0">text.similarity('What
are the health benefits of Mediterranean food?') desc</td>
</tr>
<tr>
<td id="T_9ce1b_level0_row2" class="row_heading level0 row2"
data-quarto-table-cell-role="th">Limit</td>
<td id="T_9ce1b_row2_col0" class="data row2 col0">3</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">caption</th>
<th data-quarto-table-cell-role="th">embedding</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">A person standing next to an elephant</td>
<td style="vertical-align: middle;">[ 0.009 -0.006 0.02 0.006 -0.041 -0.018 ... 0.001 0.032 0.002 0.008
0.025 -0.047]</td>
</tr>
</tbody>
</table>
`];

Pixeltable’s Voyage AI integration enables you to access
state-of-the-art embedding and reranker models via the Voyage AI API.

### Prerequisites

-   A Voyage AI account with an API key (https://www.voyageai.com/)

### Important Notes

-   Voyage AI usage may incur costs based on your Voyage AI plan.
-   Be mindful of sensitive data and consider security measures when
    integrating with external services.

First you’ll need to install required libraries and enter your Voyage AI
API key.


```python
%pip install -qU voyageai
```


```python
import os
import getpass
if 'VOYAGEAI_API_KEY' not in os.environ:
    os.environ['VOYAGEAI_API_KEY'] = getpass.getpass('Enter your Voyage AI API key:')
```

Now let’s create a Pixeltable directory to hold the tables for our demo.


```python
import pixeltable as pxt

# Remove the 'voyageai_demo' directory and its contents, if it exists
pxt.drop_dir('voyageai_demo', force=True)
pxt.create_dir('voyageai_demo')
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Connected&nbsp;to&nbsp;Pixeltable&nbsp;database&nbsp;at:&nbsp;postgresql+psycopg://postgres:@/pixeltable?host=/Users/pjlb/.pixeltable/pgdata
Created&nbsp;directory&nbsp;&#x27;voyageai_demo&#x27;.
&lt;pixeltable.catalog.dir.Dir&nbsp;at&nbsp;0x1690fe590&gt;
</pre>

## Text Embeddings

Voyage AI provides state-of-the-art embedding models for semantic search
and RAG applications.


```python
from pixeltable.functions import voyageai

# Create a table for document embeddings
docs_t = pxt.create_table('voyageai_demo.documents', {'text': pxt.String})

# Add computed column with Voyage embeddings
docs_t.add_computed_column(
    embedding=voyageai.embeddings(
        docs_t.text,
        model='voyage-3.5',
        input_type='document'
    )
)
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;&#x27;documents&#x27;.
Added&nbsp;0&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors.
No&nbsp;rows&nbsp;affected.
</pre>


```python
# Insert some sample documents
documents = [
    "The Mediterranean diet emphasizes fish, olive oil, and vegetables, believed to reduce chronic diseases.",
    "Photosynthesis in plants converts light energy into glucose and produces essential oxygen.",
    "20th-century innovations, from radios to smartphones, centered on electronic advancements.",
    "Rivers provide water, irrigation, and habitat for aquatic species, vital for ecosystems.",
    "Apple's conference call to discuss fourth fiscal quarter results is scheduled for Thursday, November 2, 2023.",
    "Shakespeare's works, like 'Hamlet' and 'A Midsummer Night's Dream,' endure in literature."
]

docs_t.insert([{'text': doc} for doc in documents])
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Inserting&nbsp;rows&nbsp;into&nbsp;\`documents\`:&nbsp;6&nbsp;rows&nbsp;\[00:00,&nbsp;734.30&nbsp;rows/s\]
Inserted&nbsp;6&nbsp;rows&nbsp;with&nbsp;0&nbsp;errors.
6&nbsp;rows&nbsp;inserted,&nbsp;12&nbsp;values&nbsp;computed.
</pre>


```python
# View the embeddings
docs_t.select(docs_t.text, docs_t.embedding).head(3)
```

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## Embedding Index for Similarity Search

You can use Voyage AI embeddings with Pixeltable’s embedding index for
efficient similarity search.


```python
# Create a table with an embedding index
search_t = pxt.create_table('voyageai_demo.search', {'text': pxt.String})

# Add embedding index for similarity search
embed_fn = voyageai.embeddings.using(model='voyage-3.5', input_type='document')
search_t.add_embedding_index('text', string_embed=embed_fn)

# Insert documents
search_t.insert([{'text': doc} for doc in documents])

# Perform similarity search
sim = search_t.text.similarity("What are the health benefits of Mediterranean food?")
search_t.order_by(sim, asc=False).limit(3).select(search_t.text, score=sim)

```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;&#x27;search&#x27;.
Inserting&nbsp;rows&nbsp;into&nbsp;\`search\`:&nbsp;6&nbsp;rows&nbsp;\[00:00,&nbsp;914.36&nbsp;rows/s\]
Inserted&nbsp;6&nbsp;rows&nbsp;with&nbsp;0&nbsp;errors.
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[1] }} />

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[2] }} />

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[3] }} />

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[4] }} />

## Reranking

Voyage AI’s rerankers can refine search results by providing more
accurate relevance scores.


```python
# Create a table for reranking
rerank_t = pxt.create_table(
    'voyageai_demo.rerank',
    {'query': pxt.String, 'documents': pxt.Json}
)

# Add computed column with reranking results
rerank_t.add_computed_column(
    reranked=voyageai.rerank(
        rerank_t.query,
        rerank_t.documents,
        model='rerank-2.5',
        top_k=3
    )
)

```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;&#x27;rerank&#x27;.
Added&nbsp;0&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors.
No&nbsp;rows&nbsp;affected.
</pre>


```python
# Insert query and documents to rerank
rerank_t.insert([{
    'query': "When is Apple's conference call scheduled?",
    'documents': documents
}])

```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Inserting&nbsp;rows&nbsp;into&nbsp;\`rerank\`:&nbsp;1&nbsp;rows&nbsp;\[00:00,&nbsp;499.74&nbsp;rows/s\]
Inserted&nbsp;1&nbsp;row&nbsp;with&nbsp;0&nbsp;errors.
1&nbsp;row&nbsp;inserted,&nbsp;2&nbsp;values&nbsp;computed.
</pre>


```python
# View reranking results
results = rerank_t.select(rerank_t.query, rerank_t.reranked).collect()
reranked_results = results[0]['reranked']['results']

print("Top 3 most relevant documents:\n")
for i, result in enumerate(reranked_results, 1):
    print(f"{i}. (Score: {result['relevance_score']:.3f})")
    print(f"   {result['document']}\n")

```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Top&nbsp;3&nbsp;most&nbsp;relevant&nbsp;documents:

1.&nbsp;(Score:&nbsp;0.930)
&nbsp;&nbsp;&nbsp;Apple&#x27;s&nbsp;conference&nbsp;call&nbsp;to&nbsp;discuss&nbsp;fourth&nbsp;fiscal&nbsp;quarter&nbsp;results&nbsp;is&nbsp;scheduled&nbsp;for&nbsp;Thursday,&nbsp;November&nbsp;2,&nbsp;2023.

2.&nbsp;(Score:&nbsp;0.283)
&nbsp;&nbsp;&nbsp;20th-century&nbsp;innovations,&nbsp;from&nbsp;radios&nbsp;to&nbsp;smartphones,&nbsp;centered&nbsp;on&nbsp;electronic&nbsp;advancements.

3.&nbsp;(Score:&nbsp;0.264)
&nbsp;&nbsp;&nbsp;The&nbsp;Mediterranean&nbsp;diet&nbsp;emphasizes&nbsp;fish,&nbsp;olive&nbsp;oil,&nbsp;and&nbsp;vegetables,&nbsp;believed&nbsp;to&nbsp;reduce&nbsp;chronic&nbsp;diseases.
</pre>

## Multimodal Embeddings

Voyage AI’s multimodal embeddings can embed images with optional text
captions.


```python
# Create a table for multimodal embeddings
mm_t = pxt.create_table('voyageai_demo.multimodal', {'image': pxt.Image, 'caption': pxt.String}, if_exists='replace')

# Add computed column with multimodal embeddings
mm_t.add_computed_column(
    embedding=voyageai.multimodal_embed(
        mm_t.image,
        mm_t.caption,
        input_type='document'
    )
)

# Insert a sample image with caption
mm_t.insert([{
    'image': 'https://raw.githubusercontent.com/pixeltable/pixeltable/main/docs/resources/images/000000000139.jpg',
    'caption': 'A person standing next to an elephant'
}])

mm_t.select(mm_t.caption, mm_t.embedding).head()

```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;&#x27;multimodal&#x27;.
Added&nbsp;0&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors.
Inserting&nbsp;rows&nbsp;into&nbsp;\`multimodal\`:&nbsp;1&nbsp;rows&nbsp;\[00:00,&nbsp;404.04&nbsp;rows/s\]
Inserted&nbsp;1&nbsp;row&nbsp;with&nbsp;0&nbsp;errors.
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[5] }} />

### Learn More

To learn more about RAG operations in Pixeltable, check out the [RAG
Operations in
Pixeltable](/notebooks/use-cases/rag-operations)
tutorial.

For more information about Voyage AI models and features, visit: -
[Voyage AI Documentation](https://docs.voyageai.com/) - [Text
Embeddings](https://docs.voyageai.com/docs/embeddings) - [Multimodal
Embeddings](https://docs.voyageai.com/docs/multimodal-embeddings) -
[Rerankers](https://docs.voyageai.com/docs/reranker)

If you have any questions, don’t hesitate to reach out.
