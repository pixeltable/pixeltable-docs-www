---
title: "Working with External Files"
icon: "notebook"
---
<a href="https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/notebooks/feature-guides/working-with-external-files.ipynb" id="openKaggle" target="_blank" rel="noopener noreferrer"><img src="https://kaggle.com/static/images/open-in-kaggle.svg" alt="Open in Kaggle" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/notebooks/feature-guides/working-with-external-files.ipynb" id="openColab" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/refs/tags/release/docs/notebooks/feature-guides/working-with-external-files.ipynb" id="downloadNotebook" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook" style={{ display: 'inline', margin: '0px' }} noZoom /></a>

<Tip>This documentation page is also available as an interactive notebook. You can launch the notebook in
Kaggle or Colab, or download it for use with an IDE or local Jupyter installation, by clicking one of the
above links.</Tip>




export const quartoRawHtml =
[`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">f</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">1</td>
</tr>
<tr>
<td style="vertical-align: middle;">1</td>
</tr>
<tr>
<td style="vertical-align: middle;">1</td>
</tr>
<tr>
<td style="vertical-align: middle;">1</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">col_0</th>
<th data-quarto-table-cell-role="th">video_errortype</th>
<th data-quarto-table-cell-role="th">video_errormsg</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">False</td>
<td style="vertical-align: middle;">None</td>
<td style="vertical-align: middle;">None</td>
</tr>
<tr>
<td style="vertical-align: middle;">False</td>
<td style="vertical-align: middle;">None</td>
<td style="vertical-align: middle;">None</td>
</tr>
<tr>
<td style="vertical-align: middle;">False</td>
<td style="vertical-align: middle;">None</td>
<td style="vertical-align: middle;">None</td>
</tr>
<tr>
<td style="vertical-align: middle;">False</td>
<td style="vertical-align: middle;">None</td>
<td style="vertical-align: middle;">None</td>
</tr>
<tr>
<td style="vertical-align: middle;">True</td>
<td style="vertical-align: middle;">Error</td>
<td style="vertical-align: middle;">Failed to download s3://multimedia-commons/bad_path.mp4: An error
occurred (404) when calling the HeadObject operation: Not Found</td>
</tr>
<tr>
<td style="vertical-align: middle;">True</td>
<td style="vertical-align: middle;">Error</td>
<td style="vertical-align: middle;">Not a valid video:
/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp3djgfyjp.mp4</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">video_errormsg</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">Failed to download s3://multimedia-commons/bad_path.mp4: An error
occurred (404) when calling the HeadObject operation: Not Found</td>
</tr>
<tr>
<td style="vertical-align: middle;">Not a valid video:
/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp3djgfyjp.mp4</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">video_fileurl</th>
<th data-quarto-table-cell-role="th">video_localpath</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">s3://multimedia-commons/data/videos/mp4/ffe/ffb/ffeffbef41bbc269810b2a1a888de.mp4</td>
<td style="vertical-align: middle;">/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_1fcfcb221263cff76a2853250fbbb2e90375dd495454c0007bc6ff4430c9a4a7.mp4</td>
</tr>
<tr>
<td style="vertical-align: middle;">s3://multimedia-commons/data/videos/mp4/ffe/feb/ffefebb41485539f964760e6115fbc44.mp4</td>
<td style="vertical-align: middle;">/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_fc11428b32768ae782193a57ebcbad706f45bbd9fa13354471e0bcd798fee3ea.mp4</td>
</tr>
<tr>
<td style="vertical-align: middle;">s3://multimedia-commons/data/videos/mp4/ffe/f73/ffef7384d698b5f70d411c696247169.mp4</td>
<td style="vertical-align: middle;">/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_b9fb0d9411bc9cd183a36866911baa7a8834f22f665bce47608566b38485c16a.mp4</td>
</tr>
<tr>
<td style="vertical-align: middle;">file:///var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp1jo4a7ca.mp4</td>
<td style="vertical-align: middle;">/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp1jo4a7ca.mp4</td>
</tr>
<tr>
<td style="vertical-align: middle;">None</td>
<td style="vertical-align: middle;">None</td>
</tr>
<tr>
<td style="vertical-align: middle;">None</td>
<td style="vertical-align: middle;">None</td>
</tr>
</tbody>
</table>
`];

In Pixeltable, all media data (videos, images, audio) resides in
external files, and Pixeltable stores references to those. The files can
be local or remote (e.g., in S3). For the latter, Pixeltable
automatically caches the files locally on access.

When interacting with media data via Pixeltable, either through queries
or UDFs, the user sees the following Python types:

-   `ImageType`: `PIL.Image.Image`
-   `VideoType`: `string` (local path)
-   `AudioType`: `string` (local path)

Letâ€™s create a table and load some data to see what that looks like:


```python
%pip install -qU pixeltable boto3
```


```python
import tempfile
import random
import shutil
import pixeltable as pxt

# First drop the `external_data` directory if it exists, to ensure
# a clean environment for the demo
pxt.drop_dir('external_data', force=True)
pxt.create_dir('external_data')
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Connected&nbsp;to&nbsp;Pixeltable&nbsp;database&nbsp;at:&nbsp;postgresql+psycopg://postgres:@/pixeltable?host=/Users/asiegel/.pixeltable/pgdata
Created&nbsp;directory&nbsp;`external_data`.
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
&lt;pixeltable.catalog.dir.Dir&nbsp;at&nbsp;0x176646bb0&gt;
</pre>


```python
v = pxt.create_table('external_data.videos', {'video': pxt.Video})

prefix = 's3://multimedia-commons/'
paths = [
    'data/videos/mp4/ffe/ffb/ffeffbef41bbc269810b2a1a888de.mp4',
    'data/videos/mp4/ffe/feb/ffefebb41485539f964760e6115fbc44.mp4',
    'data/videos/mp4/ffe/f73/ffef7384d698b5f70d411c696247169.mp4'
]
v.insert({'video': prefix + p} for p in paths)
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;`videos`.
Computing&nbsp;cells:&nbsp;&nbsp;&nbsp;0%|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;0/6&nbsp;\[00:00&lt;?,&nbsp;?&nbsp;cells/s\]
Inserting&nbsp;rows&nbsp;into&nbsp;`videos`:&nbsp;3&nbsp;rows&nbsp;\[00:00,&nbsp;1004.62&nbsp;rows/s\]
Computing&nbsp;cells:&nbsp;100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ|&nbsp;6/6&nbsp;\[00:00&lt;00:00,&nbsp;79.14&nbsp;cells/s\]
Inserted&nbsp;3&nbsp;rows&nbsp;with&nbsp;0&nbsp;errors.
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
UpdateStatus(num_rows=3,&nbsp;num_computed_values=6,&nbsp;num_excs=0,&nbsp;updated_cols=\[\],&nbsp;cols_with_excs=\[\])
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
UpdateStatus(num_rows=3,&nbsp;num_computed_values=0,&nbsp;num_excs=0,&nbsp;updated_cols=\[\],&nbsp;cols_with_excs=\[\])
</pre>

We just inserted 3 rows with video files residing in S3. When we now
query these, we are presented with their locally cached counterparts.

(Note: we donâ€™t simply display the output of `collect()` here, because
that is formatted as an HTML table with a media player and so would
obscure the file path.)


```python
rows = list(v.select(v.video).collect())
rows[0]
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
\{&#x27;video&#x27;:&nbsp;&#x27;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_1fcfcb221263cff76a2853250fbbb2e90375dd495454c0007bc6ff4430c9a4a7.mp4&#x27;\}
</pre>

Letâ€™s make a local copy of the first file and insert that separately.
First, the copy:


```python
local_path = tempfile.mktemp(suffix='.mp4')
shutil.copyfile(rows[0]['video'], local_path)
local_path
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
&#x27;/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp1jo4a7ca.mp4&#x27;
</pre>

Now the insert:


```python
v.insert([{'video': local_path}])
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Computing&nbsp;cells:&nbsp;&nbsp;&nbsp;0%|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;0/2&nbsp;\[00:00&lt;?,&nbsp;?&nbsp;cells/s\]
Inserting&nbsp;rows&nbsp;into&nbsp;`videos`:&nbsp;1&nbsp;rows&nbsp;\[00:00,&nbsp;725.78&nbsp;rows/s\]
Computing&nbsp;cells:&nbsp;100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ|&nbsp;2/2&nbsp;\[00:00&lt;00:00,&nbsp;53.23&nbsp;cells/s\]
Inserted&nbsp;1&nbsp;row&nbsp;with&nbsp;0&nbsp;errors.
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
UpdateStatus(num_rows=1,&nbsp;num_computed_values=2,&nbsp;num_excs=0,&nbsp;updated_cols=\[\],&nbsp;cols_with_excs=\[\])
</pre>

When we query this again, we see that local paths are preserved:


```python
rows = list(v.select(v.video).collect())
rows
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
\[\{&#x27;video&#x27;:&nbsp;&#x27;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_1fcfcb221263cff76a2853250fbbb2e90375dd495454c0007bc6ff4430c9a4a7.mp4&#x27;\},
&nbsp;\{&#x27;video&#x27;:&nbsp;&#x27;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_fc11428b32768ae782193a57ebcbad706f45bbd9fa13354471e0bcd798fee3ea.mp4&#x27;\},
&nbsp;\{&#x27;video&#x27;:&nbsp;&#x27;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_b9fb0d9411bc9cd183a36866911baa7a8834f22f665bce47608566b38485c16a.mp4&#x27;\},
&nbsp;\{&#x27;video&#x27;:&nbsp;&#x27;/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp1jo4a7ca.mp4&#x27;\}\]
</pre>

UDFs also see local paths:


```python
@pxt.udf
def f(v: pxt.Video) -> int:
    print(f'{type(v)}: {v}')
    return 1
```


```python
v.select(f(v.video)).show()
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
&lt;class&nbsp;&#x27;str&#x27;&gt;:&nbsp;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_1fcfcb221263cff76a2853250fbbb2e90375dd495454c0007bc6ff4430c9a4a7.mp4
&lt;class&nbsp;&#x27;str&#x27;&gt;:&nbsp;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_fc11428b32768ae782193a57ebcbad706f45bbd9fa13354471e0bcd798fee3ea.mp4
&lt;class&nbsp;&#x27;str&#x27;&gt;:&nbsp;/Users/asiegel/.pixeltable/file_cache/682f022a704d4459adb2f29f7fe9577c_0_b9fb0d9411bc9cd183a36866911baa7a8834f22f665bce47608566b38485c16a.mp4
&lt;class&nbsp;&#x27;str&#x27;&gt;:&nbsp;/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp1jo4a7ca.mp4
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## Dealing with errors

When interacting with media data in Pixeltable, the user can assume that
the underlying files exist, are local and are valid for their respective
data type. In other words, the user doesnâ€™t need to consider error
conditions.

To that end, Pixeltable validates media data on ingest. The default
behavior is to reject invalid media files:


```python
v.insert([{'video': prefix + 'bad_path.mp4'}])
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Computing&nbsp;cells:&nbsp;&nbsp;&nbsp;0%|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;0/2&nbsp;\[00:01&lt;?,&nbsp;?&nbsp;cells/s\]
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Error:&nbsp;Failed&nbsp;to&nbsp;download&nbsp;s3://multimedia-commons/bad_path.mp4:&nbsp;An&nbsp;error&nbsp;occurred&nbsp;(404)&nbsp;when&nbsp;calling&nbsp;the&nbsp;HeadObject&nbsp;operation:&nbsp;Not&nbsp;Found
\[0;31m---------------------------------------------------------------------------\[0m
\[0;31mError\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last)
Cell&nbsp;\[0;32mIn\[9\],&nbsp;line&nbsp;1\[0m
\[0;32m----&gt;&nbsp;1\[0m&nbsp;\[43mv\[49m\[38;5;241;43m.\[39;49m\[43minsert\[49m\[43m(\[49m\[43mvideo\[49m\[38;5;241;43m=\[39;49m\[43mprefix\[49m\[43m&nbsp;\[49m\[38;5;241;43m+\[39;49m\[43m&nbsp;\[49m\[38;5;124;43m&#x27;\[39;49m\[38;5;124;43mbad_path.mp4\[39;49m\[38;5;124;43m&#x27;\[39;49m\[43m)\[49m

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/catalog/insertable_table.py:125\[0m,&nbsp;in&nbsp;\[0;36mInsertableTable.insert\[0;34m(self,&nbsp;rows,&nbsp;print_stats,&nbsp;on_error,&nbsp;**kwargs)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;123\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;excs\[38;5;241m.\[39mError(\[38;5;124m&#x27;\[39m\[38;5;124mrows&nbsp;must&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;dictionaries\[39m\[38;5;124m&#x27;\[39m)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;124\[0m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_validate_input_rows(rows)
\[0;32m--&gt;&nbsp;125\[0m&nbsp;status&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43m_tbl_version\[49m\[38;5;241;43m.\[39;49m\[43minsert\[49m\[43m(\[49m\[43mrows\[49m\[43m,\[49m\[43m&nbsp;\[49m\[38;5;28;43;01mNone\[39;49;00m\[43m,\[49m\[43m&nbsp;\[49m\[43mprint_stats\[49m\[38;5;241;43m=\[39;49m\[43mprint_stats\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mfail_on_exception\[49m\[38;5;241;43m=\[39;49m\[43mfail_on_exception\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;127\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;status\[38;5;241m.\[39mnum_excs&nbsp;\[38;5;241m==\[39m&nbsp;\[38;5;241m0\[39m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;128\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cols_with_excs_str&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;124m&#x27;\[39m\[38;5;124m&#x27;\[39m

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/catalog/table_version.py:723\[0m,&nbsp;in&nbsp;\[0;36mTableVersion.insert\[0;34m(self,&nbsp;rows,&nbsp;df,&nbsp;conn,&nbsp;print_stats,&nbsp;fail_on_exception)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;721\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;conn&nbsp;\[38;5;129;01mis\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;722\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mwith\[39;00m&nbsp;Env\[38;5;241m.\[39mget()\[38;5;241m.\[39mengine\[38;5;241m.\[39mbegin()&nbsp;\[38;5;28;01mas\[39;00m&nbsp;conn:
\[0;32m--&gt;&nbsp;723\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43m_insert\[49m\[43m(\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;724\[0m&nbsp;\[43m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[49m\[43mplan\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mconn\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mtime\[49m\[38;5;241;43m.\[39;49m\[43mtime\[49m\[43m(\[49m\[43m)\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mprint_stats\[49m\[38;5;241;43m=\[39;49m\[43mprint_stats\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mrowids\[49m\[38;5;241;43m=\[39;49m\[43mrowids\[49m\[43m(\[49m\[43m)\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mabort_on_exc\[49m\[38;5;241;43m=\[39;49m\[43mfail_on_exception\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;725\[0m&nbsp;\[38;5;28;01melse\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;726\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_insert(
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;727\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plan,&nbsp;conn,&nbsp;time\[38;5;241m.\[39mtime(),&nbsp;print_stats\[38;5;241m=\[39mprint_stats,&nbsp;rowids\[38;5;241m=\[39mrowids(),&nbsp;abort_on_exc\[38;5;241m=\[39mfail_on_exception)

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/catalog/table_version.py:737\[0m,&nbsp;in&nbsp;\[0;36mTableVersion._insert\[0;34m(self,&nbsp;exec_plan,&nbsp;conn,&nbsp;timestamp,&nbsp;rowids,&nbsp;print_stats,&nbsp;abort_on_exc)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;735\[0m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39mversion&nbsp;\[38;5;241m+\[39m\[38;5;241m=\[39m&nbsp;\[38;5;241m1\[39m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;736\[0m&nbsp;result&nbsp;\[38;5;241m=\[39m&nbsp;UpdateStatus()
\[0;32m--&gt;&nbsp;737\[0m&nbsp;num_rows,&nbsp;num_excs,&nbsp;cols_with_excs&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mstore_tbl\[49m\[38;5;241;43m.\[39;49m\[43minsert_rows\[49m\[43m(\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;738\[0m&nbsp;\[43m&nbsp;&nbsp;&nbsp;&nbsp;\[49m\[43mexec_plan\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mconn\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mv_min\[49m\[38;5;241;43m=\[39;49m\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mversion\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mrowids\[49m\[38;5;241;43m=\[39;49m\[43mrowids\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mabort_on_exc\[49m\[38;5;241;43m=\[39;49m\[43mabort_on_exc\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;739\[0m&nbsp;result\[38;5;241m.\[39mnum_rows&nbsp;\[38;5;241m=\[39m&nbsp;num_rows
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;740\[0m&nbsp;result\[38;5;241m.\[39mnum_excs&nbsp;\[38;5;241m=\[39m&nbsp;num_excs

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/store.py:323\[0m,&nbsp;in&nbsp;\[0;36mStoreBase.insert_rows\[0;34m(self,&nbsp;exec_plan,&nbsp;conn,&nbsp;v_min,&nbsp;show_progress,&nbsp;rowids,&nbsp;abort_on_exc)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;321\[0m&nbsp;\[38;5;28;01mtry\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;322\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exec_plan\[38;5;241m.\[39mopen()
\[0;32m--&gt;&nbsp;323\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mfor\[39;00m&nbsp;row_batch&nbsp;\[38;5;129;01min\[39;00m&nbsp;exec_plan:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;324\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num_rows&nbsp;\[38;5;241m+\[39m\[38;5;241m=\[39m&nbsp;\[38;5;28mlen\[39m(row_batch)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;325\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mfor\[39;00m&nbsp;batch_start_idx&nbsp;\[38;5;129;01min\[39;00m&nbsp;\[38;5;28mrange\[39m(\[38;5;241m0\[39m,&nbsp;\[38;5;28mlen\[39m(row_batch),&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m__INSERT_BATCH_SIZE):
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;326\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;66;03m#&nbsp;compute&nbsp;batch&nbsp;of&nbsp;rows&nbsp;and&nbsp;convert&nbsp;them&nbsp;into&nbsp;table&nbsp;rows\[39;00m

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/exec/expr_eval_node.py:45\[0m,&nbsp;in&nbsp;\[0;36mExprEvalNode.__next__\[0;34m(self)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;44\[0m&nbsp;\[38;5;28;01mdef\[39;00m&nbsp;\[38;5;21m__next__\[39m(\[38;5;28mself\[39m)&nbsp;\[38;5;241m-\[39m\[38;5;241m&gt;\[39m&nbsp;DataRowBatch:
\[0;32m---&gt;&nbsp;45\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_batch&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;43mnext\[39;49m\[43m(\[49m\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43minput\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;46\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;66;03m#&nbsp;compute&nbsp;target&nbsp;exprs\[39;00m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;47\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mfor\[39;00m&nbsp;cohort&nbsp;\[38;5;129;01min\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39mcohorts:

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/exec/cache_prefetch_node.py:71\[0m,&nbsp;in&nbsp;\[0;36mCachePrefetchNode.__next__\[0;34m(self)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;68\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;futures\[executor\[38;5;241m.\[39msubmit(\[38;5;28mself\[39m\[38;5;241m.\[39m_fetch_url,&nbsp;row,&nbsp;info\[38;5;241m.\[39mslot_idx)\]&nbsp;\[38;5;241m=\[39m&nbsp;(row,&nbsp;info)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;69\[0m&nbsp;\[38;5;28;01mfor\[39;00m&nbsp;future&nbsp;\[38;5;129;01min\[39;00m&nbsp;concurrent\[38;5;241m.\[39mfutures\[38;5;241m.\[39mas_completed(futures):
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;70\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;66;03m#&nbsp;TODO:&nbsp;&nbsp;does&nbsp;this&nbsp;need&nbsp;to&nbsp;deal&nbsp;with&nbsp;recoverable&nbsp;errors&nbsp;(such&nbsp;as&nbsp;retry&nbsp;after&nbsp;throttling)?\[39;00m
\[0;32m---&gt;&nbsp;71\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_path&nbsp;\[38;5;241m=\[39m&nbsp;\[43mfuture\[49m\[38;5;241;43m.\[39;49m\[43mresult\[49m\[43m(\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;72\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mif\[39;00m&nbsp;tmp_path&nbsp;\[38;5;129;01mis\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;73\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mcontinue\[39;00m

File&nbsp;\[0;32m/opt/miniconda3/envs/pxt/lib/python3.9/concurrent/futures/_base.py:439\[0m,&nbsp;in&nbsp;\[0;36mFuture.result\[0;34m(self,&nbsp;timeout)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;437\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;CancelledError()
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;438\[0m&nbsp;\[38;5;28;01melif\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_state&nbsp;\[38;5;241m==\[39m&nbsp;FINISHED:
\[0;32m--&gt;&nbsp;439\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43m__get_result\[49m\[43m(\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;441\[0m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_condition\[38;5;241m.\[39mwait(timeout)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;443\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_state&nbsp;\[38;5;129;01min\[39;00m&nbsp;\[CANCELLED,&nbsp;CANCELLED_AND_NOTIFIED\]:

File&nbsp;\[0;32m/opt/miniconda3/envs/pxt/lib/python3.9/concurrent/futures/_base.py:391\[0m,&nbsp;in&nbsp;\[0;36mFuture.__get_result\[0;34m(self)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;389\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_exception:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;390\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mtry\[39;00m:
\[0;32m--&gt;&nbsp;391\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_exception
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;392\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mfinally\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;393\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;66;03m#&nbsp;Break&nbsp;a&nbsp;reference&nbsp;cycle&nbsp;with&nbsp;the&nbsp;exception&nbsp;in&nbsp;self._exception\[39;00m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;394\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28mself\[39m&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;01mNone\[39;00m

File&nbsp;\[0;32m/opt/miniconda3/envs/pxt/lib/python3.9/concurrent/futures/thread.py:58\[0m,&nbsp;in&nbsp;\[0;36m_WorkItem.run\[0;34m(self)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;55\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;57\[0m&nbsp;\[38;5;28;01mtry\[39;00m:
\[0;32m---&gt;&nbsp;58\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mfn\[49m\[43m(\[49m\[38;5;241;43m*\[39;49m\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43margs\[49m\[43m,\[49m\[43m&nbsp;\[49m\[38;5;241;43m*\[39;49m\[38;5;241;43m*\[39;49m\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mkwargs\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;59\[0m&nbsp;\[38;5;28;01mexcept\[39;00m&nbsp;\[38;5;167;01mBaseException\[39;00m&nbsp;\[38;5;28;01mas\[39;00m&nbsp;exc:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39mfuture\[38;5;241m.\[39mset_exception(exc)

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/exec/cache_prefetch_node.py:115\[0m,&nbsp;in&nbsp;\[0;36mCachePrefetchNode._fetch_url\[0;34m(self,&nbsp;row,&nbsp;slot_idx)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;113\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39mrow_builder\[38;5;241m.\[39mset_exc(row,&nbsp;slot_idx,&nbsp;exc)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;114\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mif\[39;00m&nbsp;\[38;5;129;01mnot\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39mctx\[38;5;241m.\[39mignore_errors:
\[0;32m--&gt;&nbsp;115\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;exc&nbsp;\[38;5;28;01mfrom\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m&nbsp;&nbsp;\[38;5;66;03m#&nbsp;suppress&nbsp;original&nbsp;exception\[39;00m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;116\[0m&nbsp;\[38;5;28;01mreturn\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m

\[0;31mError\[0m:&nbsp;Failed&nbsp;to&nbsp;download&nbsp;s3://multimedia-commons/bad_path.mp4:&nbsp;An&nbsp;error&nbsp;occurred&nbsp;(404)&nbsp;when&nbsp;calling&nbsp;the&nbsp;HeadObject&nbsp;operation:&nbsp;Not&nbsp;Found
</pre>

The same happens for corrupted files:


```python
# create invalid .mp4
with tempfile.NamedTemporaryFile(mode='wb', suffix='.mp4', delete=False) as temp_file:
    temp_file.write(random.randbytes(1024))
    corrupted_path = temp_file.name

v.insert([{'video': corrupted_path}])
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Computing&nbsp;cells:&nbsp;100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ|&nbsp;2/2&nbsp;\[00:00&lt;00:00,&nbsp;1084.64&nbsp;cells/s\]
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Error:&nbsp;Not&nbsp;a&nbsp;valid&nbsp;video:&nbsp;/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp3djgfyjp.mp4
\[0;31m---------------------------------------------------------------------------\[0m
\[0;31mError\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last)
Cell&nbsp;\[0;32mIn\[10\],&nbsp;line&nbsp;6\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp_file\[38;5;241m.\[39mwrite(random\[38;5;241m.\[39mrandbytes(\[38;5;241m1024\[39m))
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;corrupted_path&nbsp;\[38;5;241m=\[39m&nbsp;temp_file\[38;5;241m.\[39mname
\[0;32m----&gt;&nbsp;6\[0m&nbsp;\[43mv\[49m\[38;5;241;43m.\[39;49m\[43minsert\[49m\[43m(\[49m\[43mvideo\[49m\[38;5;241;43m=\[39;49m\[43mcorrupted_path\[49m\[43m)\[49m

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/catalog/insertable_table.py:125\[0m,&nbsp;in&nbsp;\[0;36mInsertableTable.insert\[0;34m(self,&nbsp;rows,&nbsp;print_stats,&nbsp;on_error,&nbsp;**kwargs)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;123\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;excs\[38;5;241m.\[39mError(\[38;5;124m&#x27;\[39m\[38;5;124mrows&nbsp;must&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;dictionaries\[39m\[38;5;124m&#x27;\[39m)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;124\[0m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_validate_input_rows(rows)
\[0;32m--&gt;&nbsp;125\[0m&nbsp;status&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43m_tbl_version\[49m\[38;5;241;43m.\[39;49m\[43minsert\[49m\[43m(\[49m\[43mrows\[49m\[43m,\[49m\[43m&nbsp;\[49m\[38;5;28;43;01mNone\[39;49;00m\[43m,\[49m\[43m&nbsp;\[49m\[43mprint_stats\[49m\[38;5;241;43m=\[39;49m\[43mprint_stats\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mfail_on_exception\[49m\[38;5;241;43m=\[39;49m\[43mfail_on_exception\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;127\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;status\[38;5;241m.\[39mnum_excs&nbsp;\[38;5;241m==\[39m&nbsp;\[38;5;241m0\[39m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;128\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cols_with_excs_str&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;124m&#x27;\[39m\[38;5;124m&#x27;\[39m

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/catalog/table_version.py:723\[0m,&nbsp;in&nbsp;\[0;36mTableVersion.insert\[0;34m(self,&nbsp;rows,&nbsp;df,&nbsp;conn,&nbsp;print_stats,&nbsp;fail_on_exception)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;721\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;conn&nbsp;\[38;5;129;01mis\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;722\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mwith\[39;00m&nbsp;Env\[38;5;241m.\[39mget()\[38;5;241m.\[39mengine\[38;5;241m.\[39mbegin()&nbsp;\[38;5;28;01mas\[39;00m&nbsp;conn:
\[0;32m--&gt;&nbsp;723\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43m_insert\[49m\[43m(\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;724\[0m&nbsp;\[43m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[49m\[43mplan\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mconn\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mtime\[49m\[38;5;241;43m.\[39;49m\[43mtime\[49m\[43m(\[49m\[43m)\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mprint_stats\[49m\[38;5;241;43m=\[39;49m\[43mprint_stats\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mrowids\[49m\[38;5;241;43m=\[39;49m\[43mrowids\[49m\[43m(\[49m\[43m)\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mabort_on_exc\[49m\[38;5;241;43m=\[39;49m\[43mfail_on_exception\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;725\[0m&nbsp;\[38;5;28;01melse\[39;00m:
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;726\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39m_insert(
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;727\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plan,&nbsp;conn,&nbsp;time\[38;5;241m.\[39mtime(),&nbsp;print_stats\[38;5;241m=\[39mprint_stats,&nbsp;rowids\[38;5;241m=\[39mrowids(),&nbsp;abort_on_exc\[38;5;241m=\[39mfail_on_exception)

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/catalog/table_version.py:737\[0m,&nbsp;in&nbsp;\[0;36mTableVersion._insert\[0;34m(self,&nbsp;exec_plan,&nbsp;conn,&nbsp;timestamp,&nbsp;rowids,&nbsp;print_stats,&nbsp;abort_on_exc)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;735\[0m&nbsp;\[38;5;28mself\[39m\[38;5;241m.\[39mversion&nbsp;\[38;5;241m+\[39m\[38;5;241m=\[39m&nbsp;\[38;5;241m1\[39m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;736\[0m&nbsp;result&nbsp;\[38;5;241m=\[39m&nbsp;UpdateStatus()
\[0;32m--&gt;&nbsp;737\[0m&nbsp;num_rows,&nbsp;num_excs,&nbsp;cols_with_excs&nbsp;\[38;5;241m=\[39m&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mstore_tbl\[49m\[38;5;241;43m.\[39;49m\[43minsert_rows\[49m\[43m(\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;738\[0m&nbsp;\[43m&nbsp;&nbsp;&nbsp;&nbsp;\[49m\[43mexec_plan\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mconn\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mv_min\[49m\[38;5;241;43m=\[39;49m\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mversion\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mrowids\[49m\[38;5;241;43m=\[39;49m\[43mrowids\[49m\[43m,\[49m\[43m&nbsp;\[49m\[43mabort_on_exc\[49m\[38;5;241;43m=\[39;49m\[43mabort_on_exc\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;739\[0m&nbsp;result\[38;5;241m.\[39mnum_rows&nbsp;\[38;5;241m=\[39m&nbsp;num_rows
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;740\[0m&nbsp;result\[38;5;241m.\[39mnum_excs&nbsp;\[38;5;241m=\[39m&nbsp;num_excs

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/store.py:334\[0m,&nbsp;in&nbsp;\[0;36mStoreBase.insert_rows\[0;34m(self,&nbsp;exec_plan,&nbsp;conn,&nbsp;v_min,&nbsp;show_progress,&nbsp;rowids,&nbsp;abort_on_exc)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;332\[0m&nbsp;\[38;5;28;01mif\[39;00m&nbsp;abort_on_exc&nbsp;\[38;5;129;01mand\[39;00m&nbsp;row\[38;5;241m.\[39mhas_exc():
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;333\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exc&nbsp;\[38;5;241m=\[39m&nbsp;row\[38;5;241m.\[39mget_first_exc()
\[0;32m--&gt;&nbsp;334\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;exc
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;336\[0m&nbsp;rowid&nbsp;\[38;5;241m=\[39m&nbsp;(\[38;5;28mnext\[39m(rowids),)&nbsp;\[38;5;28;01mif\[39;00m&nbsp;rowids&nbsp;\[38;5;129;01mis\[39;00m&nbsp;\[38;5;129;01mnot\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m&nbsp;\[38;5;28;01melse\[39;00m&nbsp;row\[38;5;241m.\[39mpk\[:\[38;5;241m-\[39m\[38;5;241m1\[39m\]
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;337\[0m&nbsp;pk&nbsp;\[38;5;241m=\[39m&nbsp;rowid&nbsp;\[38;5;241m+\[39m&nbsp;(v_min,)

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/exprs/column_ref.py:159\[0m,&nbsp;in&nbsp;\[0;36mColumnRef.eval\[0;34m(self,&nbsp;data_row,&nbsp;row_builder)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;156\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mreturn\[39;00m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;158\[0m&nbsp;\[38;5;28;01mtry\[39;00m:
\[0;32m--&gt;&nbsp;159\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;43mself\[39;49m\[38;5;241;43m.\[39;49m\[43mcol\[49m\[38;5;241;43m.\[39;49m\[43mcol_type\[49m\[38;5;241;43m.\[39;49m\[43mvalidate_media\[49m\[43m(\[49m\[43mdata_row\[49m\[38;5;241;43m.\[39;49m\[43mfile_paths\[49m\[43m\[\[49m\[43munvalidated_slot_idx\[49m\[43m\]\[49m\[43m)\[49m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;160\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;66;03m#&nbsp;access&nbsp;the&nbsp;value&nbsp;only&nbsp;after&nbsp;successful&nbsp;validation\[39;00m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;161\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;\[38;5;241m=\[39m&nbsp;data_row\[unvalidated_slot_idx\]

File&nbsp;\[0;32m~/Dropbox/workspace/pixeltable/pixeltable/pixeltable/type_system.py:906\[0m,&nbsp;in&nbsp;\[0;36mVideoType.validate_media\[0;34m(self,&nbsp;val)\[0m
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;904\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;excs\[38;5;241m.\[39mError(\[38;5;124mf\[39m\[38;5;124m&#x27;\[39m\[38;5;124mNot&nbsp;a&nbsp;valid&nbsp;video:&nbsp;\[39m\[38;5;132;01m\{\[39;00mval\[38;5;132;01m\}\[39;00m\[38;5;124m&#x27;\[39m)
\[1;32m&nbsp;&nbsp;&nbsp;&nbsp;905\[0m&nbsp;\[38;5;28;01mexcept\[39;00m&nbsp;av\[38;5;241m.\[39mAVError:
\[0;32m--&gt;&nbsp;906\[0m&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\[38;5;28;01mraise\[39;00m&nbsp;excs\[38;5;241m.\[39mError(\[38;5;124mf\[39m\[38;5;124m&#x27;\[39m\[38;5;124mNot&nbsp;a&nbsp;valid&nbsp;video:&nbsp;\[39m\[38;5;132;01m\{\[39;00mval\[38;5;132;01m\}\[39;00m\[38;5;124m&#x27;\[39m)&nbsp;\[38;5;28;01mfrom\[39;00m&nbsp;\[38;5;28;01mNone\[39;00m

\[0;31mError\[0m:&nbsp;Not&nbsp;a&nbsp;valid&nbsp;video:&nbsp;/var/folders/hb/qd0dztsj43j_mdb6hbl1gzyc0000gn/T/tmp3djgfyjp.mp4
</pre>

Alternatively, Pixeltable can also be instructed to record error
conditions and proceed with the ingest, via the `on_error` flag
(default: `'abort'`):


```python
v.insert([{'video': prefix + 'bad_path.mp4'}, {'video': corrupted_path}], on_error='ignore')
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Computing&nbsp;cells:&nbsp;100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ|&nbsp;4/4&nbsp;\[00:00&lt;00:00,&nbsp;20.98&nbsp;cells/s\]
Inserting&nbsp;rows&nbsp;into&nbsp;`videos`:&nbsp;2&nbsp;rows&nbsp;\[00:00,&nbsp;671.63&nbsp;rows/s\]
Computing&nbsp;cells:&nbsp;100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ|&nbsp;4/4&nbsp;\[00:00&lt;00:00,&nbsp;20.13&nbsp;cells/s\]
Inserted&nbsp;2&nbsp;rows&nbsp;with&nbsp;4&nbsp;errors&nbsp;across&nbsp;2&nbsp;columns&nbsp;(videos.video,&nbsp;videos.None).
</pre>

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
UpdateStatus(num_rows=2,&nbsp;num_computed_values=4,&nbsp;num_excs=4,&nbsp;updated_cols=\[\],&nbsp;cols_with_excs=\[&#x27;videos.video&#x27;,&nbsp;&#x27;videos.None&#x27;\])
</pre>

Every media column has properties `errortype` and `errormsg` (both
containing `string` data) that indicate whether the column value is
valid. Invalid values show up as `None` and have non-null
`errortype`/`errormsg`:


```python
v.select(v.video == None, v.video.errortype, v.video.errormsg).collect()
```

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[1] }} />

Errors can now be inspected (and corrected) after the ingest:


```python
v.where(v.video.errortype != None).select(v.video.errormsg).collect()
```

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[2] }} />

## Accessing the original file paths

In some cases, it will be necessary to access file paths (not, say, the
`PIL.Image.Image`), and Pixeltable provides the column properties
`fileurl` and `localpath` for that purpose:


```python
v.select(v.video.fileurl, v.video.localpath).collect()
```

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[3] }} />

Note that for local media files, the `fileurl` property still returns a
parsable URL.
