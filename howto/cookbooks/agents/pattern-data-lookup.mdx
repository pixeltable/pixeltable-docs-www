---
title: "Look up structured data with retrieval UDFs"
sidebarTitle: "Look up structured data with retrieval UDFs"
icon: "notebook"
---
<a href="https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/release/howto/cookbooks/agents/pattern-data-lookup.ipynb" id="openKaggle" target="_blank" rel="noopener noreferrer"><img src="https://kaggle.com/static/images/open-in-kaggle.svg" alt="Open in Kaggle" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/release/howto/cookbooks/agents/pattern-data-lookup.ipynb" id="openColab" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/refs/tags/release/docs/release/howto/cookbooks/agents/pattern-data-lookup.ipynb" id="downloadNotebook" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook" style={{ display: 'inline', margin: '0px' }} noZoom /></a>

<Tip>This documentation page is also available as an interactive notebook. You can launch the notebook in
Kaggle or Colab, or download it for use with an IDE or local Jupyter installation, by clicking one of the
above links.</Tip>




export const quartoRawHtml =
[`
<table>
<thead>
<tr>
<th>Use case</th>
<th>Lookup key</th>
<th>Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">Customer support</td>
<td style="vertical-align: middle;"><code>customer_id</code></td>
<td style="vertical-align: middle;">Contact info, order history</td>
</tr>
<tr>
<td style="vertical-align: middle;">Product search</td>
<td style="vertical-align: middle;"><code>sku</code> or <code>product_name</code></td>
<td style="vertical-align: middle;">Price, inventory, specs</td>
</tr>
<tr>
<td style="vertical-align: middle;">Financial analysis</td>
<td style="vertical-align: middle;"><code>ticker</code> or <code>date</code></td>
<td style="vertical-align: middle;">Stock prices, transactions</td>
</tr>
<tr>
<td style="vertical-align: middle;">Inventory check</td>
<td style="vertical-align: middle;"><code>warehouse_id</code>, <code>product_id</code></td>
<td style="vertical-align: middle;">Stock levels</td>
</tr>
</tbody>
</table>
`,`
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;"><code>table</code></td>
<td style="vertical-align: middle;">The table to query</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>name</code></td>
<td style="vertical-align: middle;">Function name (defaults to table name)</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>description</code></td>
<td style="vertical-align: middle;">Description for LLM tool use</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>parameters</code></td>
<td style="vertical-align: middle;">Columns to use as lookup keys</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>limit</code></td>
<td style="vertical-align: middle;">Max rows to return (None = all)</td>
</tr>
</tbody>
</table>
`,`
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">Data enrichment</td>
<td style="vertical-align: middle;">Join order SKUs to product details</td>
</tr>
<tr>
<td style="vertical-align: middle;">LLM tool calling</td>
<td style="vertical-align: middle;">Let agents query databases</td>
</tr>
<tr>
<td style="vertical-align: middle;">Reference lookups</td>
<td style="vertical-align: middle;">Convert codes to descriptions</td>
</tr>
<tr>
<td style="vertical-align: middle;">Cross-table joins</td>
<td style="vertical-align: middle;">Link related records</td>
</tr>
</tbody>
</table>
`];

Create lookup functions that query tables by key—for customer records,
product catalogs, or financial data.

## Problem

You have structured data—customer records, product catalogs, financial
data—and need to look up rows by key values. Common scenarios:

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## Solution

**What’s in this recipe:** - Create lookup functions from tables with
`retrieval_udf` - Query by single or multiple keys - Use lookups in
computed columns for data enrichment

Use `pxt.retrieval_udf(table)` to automatically create a function that
queries the table by its columns.

### Setup


```python
%pip install -qU pixeltable

```


```python
import pixeltable as pxt

```


```python
# Create a fresh directory
pxt.drop_dir('lookup_demo', force=True)
pxt.create_dir('lookup_demo')

```

### Create a product catalog table


```python
# Create a product catalog
products = pxt.create_table(
    'lookup_demo.products',
    {'sku': pxt.String, 'name': pxt.String, 'price': pxt.Float, 'category': pxt.String}
)

products.insert([
    {'sku': 'LAPTOP-001', 'name': 'MacBook Pro 14"', 'price': 1999.00, 'category': 'electronics'},
    {'sku': 'LAPTOP-002', 'name': 'ThinkPad X1', 'price': 1499.00, 'category': 'electronics'},
    {'sku': 'PHONE-001', 'name': 'iPhone 15 Pro', 'price': 999.00, 'category': 'electronics'},
    {'sku': 'CHAIR-001', 'name': 'Ergonomic Office Chair', 'price': 449.00, 'category': 'furniture'},
    {'sku': 'DESK-001', 'name': 'Standing Desk', 'price': 699.00, 'category': 'furniture'},
])

products.collect()

```

### Create a lookup function with retrieval_udf


```python
# Create a lookup function that searches by SKU
get_product = pxt.retrieval_udf(
    products,
    name='get_product',
    description='Look up a product by its SKU code',
    parameters=['sku'],  # Only use SKU as the lookup key
    limit=1  # Return at most 1 result
)
# Check the function signature
print(f"Function: {get_product.name}")
print(f"Description: {get_product.comment()}")


```


```python
# Look up a product by SKU
result = products.select(get_product(sku='LAPTOP-001')).limit(1).collect()
print("Lookup result:", result[0]['get_product'])

```

### Look up by category (multiple results)


```python
# Create a category lookup (returns multiple products)
get_by_category = pxt.retrieval_udf(
    products,
    name='get_by_category',
    description='Get all products in a category',
    parameters=['category'],
    limit=10  # Return up to 10 products
)

# Find all electronics
result = products.select(get_by_category(category='electronics')).limit(1).collect()
print("Electronics products:")
for product in result[0]['get_by_category']:
    print(f"  {product['sku']}: {product['name']} - ${product['price']}")

```

### Use lookups for data enrichment


```python
# Create an orders table
orders = pxt.create_table(
    'lookup_demo.orders',
    {'order_id': pxt.String, 'product_sku': pxt.String, 'quantity': pxt.Int}
)

orders.insert([
    {'order_id': 'ORD-001', 'product_sku': 'LAPTOP-001', 'quantity': 2},
    {'order_id': 'ORD-002', 'product_sku': 'PHONE-001', 'quantity': 1},
    {'order_id': 'ORD-003', 'product_sku': 'CHAIR-001', 'quantity': 4},
])

```


```python
# Add a computed column that enriches orders with product details
orders.add_computed_column(product_info=get_product(sku=orders.product_sku))

# View enriched orders
orders.select(
    orders.order_id,
    orders.product_sku,
    orders.quantity,
    orders.product_info
).collect()

```

## Explanation

**`retrieval_udf` parameters:**

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[1] }} />

**Use cases:**

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[2] }} />

**Tips:** - Use `limit=1` for unique key lookups - Specify only needed
columns in `parameters` for cleaner APIs - Add descriptions for LLM tool
integration

## See also

-   [Use tool calling with
    LLMs](/howto/cookbooks/agents/llm-tool-calling) -
    Use retrieval UDFs as LLM tools
-   [Build a RAG
    pipeline](/howto/cookbooks/agents/pattern-rag-pipeline) -
    Semantic search with `@pxt.query`
