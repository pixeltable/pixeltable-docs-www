---
title: "Look up structured data with retrieval UDFs"
sidebarTitle: "Look up structured data with retrieval UDFs"
icon: "notebook"
---
<a href="https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/release/howto/cookbooks/agents/pattern-data-lookup.ipynb" id="openKaggle" target="_blank" rel="noopener noreferrer"><img src="https://kaggle.com/static/images/open-in-kaggle.svg" alt="Open in Kaggle" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/release/howto/cookbooks/agents/pattern-data-lookup.ipynb" id="openColab" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/refs/tags/release/docs/release/howto/cookbooks/agents/pattern-data-lookup.ipynb" id="downloadNotebook" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook" style={{ display: 'inline', margin: '0px' }} noZoom /></a>

<Tip>This documentation page is also available as an interactive notebook. You can launch the notebook in
Kaggle or Colab, or download it for use with an IDE or local Jupyter installation, by clicking one of the
above links.</Tip>




export const quartoRawHtml =
[`
<table>
<thead>
<tr>
<th>Use case</th>
<th>Lookup key</th>
<th>Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">Customer support</td>
<td style="vertical-align: middle;"><code>customer_id</code></td>
<td style="vertical-align: middle;">Contact info, order history</td>
</tr>
<tr>
<td style="vertical-align: middle;">Product search</td>
<td style="vertical-align: middle;"><code>sku</code> or <code>product_name</code></td>
<td style="vertical-align: middle;">Price, inventory, specs</td>
</tr>
<tr>
<td style="vertical-align: middle;">Financial analysis</td>
<td style="vertical-align: middle;"><code>ticker</code> or <code>date</code></td>
<td style="vertical-align: middle;">Stock prices, transactions</td>
</tr>
<tr>
<td style="vertical-align: middle;">Inventory check</td>
<td style="vertical-align: middle;"><code>warehouse_id</code>, <code>product_id</code></td>
<td style="vertical-align: middle;">Stock levels</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">sku</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">category</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">LAPTOP-001</td>
<td style="vertical-align: middle;">MacBook Pro 14"</td>
<td style="vertical-align: middle;">1999.</td>
<td style="vertical-align: middle;">electronics</td>
</tr>
<tr>
<td style="vertical-align: middle;">LAPTOP-002</td>
<td style="vertical-align: middle;">ThinkPad X1</td>
<td style="vertical-align: middle;">1499.</td>
<td style="vertical-align: middle;">electronics</td>
</tr>
<tr>
<td style="vertical-align: middle;">PHONE-001</td>
<td style="vertical-align: middle;">iPhone 15 Pro</td>
<td style="vertical-align: middle;">999.</td>
<td style="vertical-align: middle;">electronics</td>
</tr>
<tr>
<td style="vertical-align: middle;">CHAIR-001</td>
<td style="vertical-align: middle;">Ergonomic Office Chair</td>
<td style="vertical-align: middle;">449.</td>
<td style="vertical-align: middle;">furniture</td>
</tr>
<tr>
<td style="vertical-align: middle;">DESK-001</td>
<td style="vertical-align: middle;">Standing Desk</td>
<td style="vertical-align: middle;">699.</td>
<td style="vertical-align: middle;">furniture</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">get_by_category</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">[{"sku": "LAPTOP-001", "name": "MacBook Pro 14\"", "price": 1999.,
"category": "electronics"}, {"sku": "LAPTOP-002", "name": "ThinkPad X1",
"price": 1499., "category": "electronics"}, {"sku": "PHONE-001", "name":
"iPhone 15 Pro", "price": 999., "category": "electronics"}]</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">order_id</th>
<th data-quarto-table-cell-role="th">product_sku</th>
<th data-quarto-table-cell-role="th">quantity</th>
<th data-quarto-table-cell-role="th">product_info</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">ORD-001</td>
<td style="vertical-align: middle;">LAPTOP-001</td>
<td style="vertical-align: middle;">2</td>
<td style="vertical-align: middle;">[{"sku": "LAPTOP-001", "name": "MacBook Pro 14\"", "price": 1999.,
"category": "electronics"}]</td>
</tr>
<tr>
<td style="vertical-align: middle;">ORD-002</td>
<td style="vertical-align: middle;">PHONE-001</td>
<td style="vertical-align: middle;">1</td>
<td style="vertical-align: middle;">[{"sku": "PHONE-001", "name": "iPhone 15 Pro", "price": 999.,
"category": "electronics"}]</td>
</tr>
<tr>
<td style="vertical-align: middle;">ORD-003</td>
<td style="vertical-align: middle;">CHAIR-001</td>
<td style="vertical-align: middle;">4</td>
<td style="vertical-align: middle;">[{"sku": "CHAIR-001", "name": "Ergonomic Office Chair", "price":
449., "category": "furniture"}]</td>
</tr>
</tbody>
</table>
`,`
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;"><code>table</code></td>
<td style="vertical-align: middle;">The table to query</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>name</code></td>
<td style="vertical-align: middle;">Function name (defaults to table name)</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>description</code></td>
<td style="vertical-align: middle;">Description for LLM tool use</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>parameters</code></td>
<td style="vertical-align: middle;">Columns to use as lookup keys</td>
</tr>
<tr>
<td style="vertical-align: middle;"><code>limit</code></td>
<td style="vertical-align: middle;">Max rows to return (None = all)</td>
</tr>
</tbody>
</table>
`,`
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">Data enrichment</td>
<td style="vertical-align: middle;">Join order SKUs to product details</td>
</tr>
<tr>
<td style="vertical-align: middle;">LLM tool calling</td>
<td style="vertical-align: middle;">Let agents query databases</td>
</tr>
<tr>
<td style="vertical-align: middle;">Reference lookups</td>
<td style="vertical-align: middle;">Convert codes to descriptions</td>
</tr>
<tr>
<td style="vertical-align: middle;">Cross-table joins</td>
<td style="vertical-align: middle;">Link related records</td>
</tr>
</tbody>
</table>
`];

Create lookup functions that query tables by key—for customer records,
product catalogs, or financial data.

## Problem

You have structured data—customer records, product catalogs, financial
data—and need to look up rows by key values. Common scenarios:

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## Solution

**What’s in this recipe:**

-   Create lookup functions from tables with `retrieval_udf`
-   Query by single or multiple keys
-   Use lookups in computed columns for data enrichment

Use `pxt.retrieval_udf(table)` to automatically create a function that
queries the table by its columns.

### Setup


```python
%pip install -qU pixeltable
```


```python
import pixeltable as pxt
```


```python
# Create a fresh directory
pxt.drop_dir('lookup_demo', force=True)
pxt.create_dir('lookup_demo')
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Connected&nbsp;to&nbsp;Pixeltable&nbsp;database&nbsp;at:&nbsp;postgresql+psycopg://postgres:@/pixeltable?host=/Users/pjlb/.pixeltable/pgdata
Created&nbsp;directory&nbsp;&#x27;lookup_demo&#x27;.
&lt;pixeltable.catalog.dir.Dir&nbsp;at&nbsp;0x143224e50&gt;
</pre>

### Create a product catalog table


```python
# Create a product catalog
products = pxt.create_table(
    'lookup_demo.products',
    {'sku': pxt.String, 'name': pxt.String, 'price': pxt.Float, 'category': pxt.String}
)

products.insert([
    {'sku': 'LAPTOP-001', 'name': 'MacBook Pro 14"', 'price': 1999.00, 'category': 'electronics'},
    {'sku': 'LAPTOP-002', 'name': 'ThinkPad X1', 'price': 1499.00, 'category': 'electronics'},
    {'sku': 'PHONE-001', 'name': 'iPhone 15 Pro', 'price': 999.00, 'category': 'electronics'},
    {'sku': 'CHAIR-001', 'name': 'Ergonomic Office Chair', 'price': 449.00, 'category': 'furniture'},
    {'sku': 'DESK-001', 'name': 'Standing Desk', 'price': 699.00, 'category': 'furniture'},
])

products.collect()
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;&#x27;products&#x27;.
Inserting&nbsp;rows&nbsp;into&nbsp;\`products\`:&nbsp;5&nbsp;rows&nbsp;\[00:00,&nbsp;502.31&nbsp;rows/s\]
Inserted&nbsp;5&nbsp;rows&nbsp;with&nbsp;0&nbsp;errors.
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[1] }} />

### Create a lookup function with retrieval_udf


```python
# Create a lookup function that searches by SKU
get_product = pxt.retrieval_udf(
    products,
    name='get_product',
    description='Look up a product by its SKU code',
    parameters=['sku'],  # Only use SKU as the lookup key
    limit=1  # Return at most 1 result
)
# Check the function signature
```


```python
# Look up a product by SKU
result = products.select(get_product(sku='LAPTOP-001')).limit(1).collect()
```

### Look up by category (multiple results)


```python
# Create a category lookup (returns multiple products)
get_by_category = pxt.retrieval_udf(
    products,
    name="get_by_category",
    description="Get all products in a category",
    parameters=["category"],
    limit=10  # Return up to 10 products
)

# Find all electronics
products.select(get_by_category(category="electronics")).limit(1).collect()
```

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[2] }} />

### Use lookups for data enrichment


```python
# Create an orders table
orders = pxt.create_table(
    'lookup_demo.orders',
    {'order_id': pxt.String, 'product_sku': pxt.String, 'quantity': pxt.Int}
)

orders.insert([
    {'order_id': 'ORD-001', 'product_sku': 'LAPTOP-001', 'quantity': 2},
    {'order_id': 'ORD-002', 'product_sku': 'PHONE-001', 'quantity': 1},
    {'order_id': 'ORD-003', 'product_sku': 'CHAIR-001', 'quantity': 4},
])
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Created&nbsp;table&nbsp;&#x27;orders&#x27;.
Inserting&nbsp;rows&nbsp;into&nbsp;\`orders\`:&nbsp;3&nbsp;rows&nbsp;\[00:00,&nbsp;1186.28&nbsp;rows/s\]
Inserted&nbsp;3&nbsp;rows&nbsp;with&nbsp;0&nbsp;errors.
3&nbsp;rows&nbsp;inserted,&nbsp;6&nbsp;values&nbsp;computed.
</pre>


```python
# Add a computed column that enriches orders with product details
orders.add_computed_column(product_info=get_product(sku=orders.product_sku))

# View enriched orders
orders.select(
    orders.order_id,
    orders.product_sku,
    orders.quantity,
    orders.product_info
).collect()
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Added&nbsp;3&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors.
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[3] }} />

## Explanation

**`retrieval_udf` parameters:**

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[4] }} />

**Use cases:**

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[5] }} />

**Tips:**

-   Use `limit=1` for unique key lookups
-   Specify only needed columns in `parameters` for cleaner APIs
-   Add descriptions for LLM tool integration

## See also

-   [Use tool calling with
    LLMs](/howto/cookbooks/agents/llm-tool-calling) -
    Use retrieval UDFs as LLM tools
-   [Build a RAG
    pipeline](/howto/cookbooks/agents/pattern-rag-pipeline) -
    Semantic search with `@pxt.query`
