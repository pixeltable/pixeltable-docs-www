---
title: "Working with llama.cpp in Pixeltable"
sidebarTitle: "llama.cpp"
icon: "notebook"
---
<a href="https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/release/howto/providers/working-with-llama-cpp.ipynb" id="openKaggle" target="_blank" rel="noopener noreferrer"><img src="https://kaggle.com/static/images/open-in-kaggle.svg" alt="Open in Kaggle" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/release/howto/providers/working-with-llama-cpp.ipynb" id="openColab" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" style={{ display: 'inline', margin: '0px' }} noZoom /></a>&nbsp;&nbsp;<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/refs/tags/release/docs/release/howto/providers/working-with-llama-cpp.ipynb" id="downloadNotebook" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook" style={{ display: 'inline', margin: '0px' }} noZoom /></a>

<Tip>This documentation page is also available as an interactive notebook. You can launch the notebook in
Kaggle or Colab, or download it for use with an IDE or local Jupyter installation, by clicking one of the
above links.</Tip>




export const quartoRawHtml =
[`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">input</th>
<th data-quarto-table-cell-role="th">output</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">What is the capital of France?</td>
<td style="vertical-align: middle;">The capital of France is Paris.</td>
</tr>
<tr>
<td style="vertical-align: middle;">What are some edible species of fish?</td>
<td style="vertical-align: middle;">There are many edible species of fish, including: 1. Tilapia - a
popular fish for both freshwater and saltwater environments. It's known
for its small size and easy to cook. 2. Cod - a large fish that can grow
to be over 20 pounds. It's often used in fish stew or as a main course.
3. Salmon - a fish that can be found in both freshwater and saltwater
environments. It's known for its rich, flavorful flesh and is often used
in fish tacos or as a main course. 4. Trout - a fish that can be fo
...... slightly sweet flavor and is often used in fish tacos or as a
main course. 8. Flounder - a fish that can be found in both freshwater
and saltwater environments. It's known for its mild, slightly sweet
flavor and is often used in fish tacos or as a main course. 9. Tilapia -
a popular fish for both freshwater and saltwater environments. It's
known for its small size and easy to cook. 10. Cod - a large fish that
can grow to be over 20 pounds. It's often used in fish stew or as a main
course.</td>
</tr>
<tr>
<td style="vertical-align: middle;">Who are the most prominent classical composers?</td>
<td style="vertical-align: middle;">The most prominent classical composers include: 1. Ludwig van
Beethoven - known for his symphonies, piano sonatas, and operas 2.
Wolfgang Amadeus Mozart - known for his operas, symphonies, and chamber
music 3. Johann Sebastian Bach - known for his sacred works, concertos,
and fugues 4. Antonio Vivaldi - known for his concertos, string
quartets, and violin sonatas 5. Ludwig van Beethoven - known for his
symphonies, piano sonatas, and operas 6. George Frideric Handel - known
for his oratorios, operas, and string quartets 7. Johann Sebastian Bach
- known for his sacred works, concertos, and fugues 8. Antonio Vivaldi -
known for his concertos, string quartets, and violin sonatas 9. George
Frideric Handel - known for his oratorios, operas, and string quartets
10. Johann Sebastian Bach - known for his sacred works, concertos, and
fugues These composers have had a significant impact on the development
of classical music and continue to be studied and performed to this
day.</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">input</th>
<th data-quarto-table-cell-role="th">output</th>
<th data-quarto-table-cell-role="th">output_l3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">What is the capital of France?</td>
<td style="vertical-align: middle;">The capital of France is Paris.</td>
<td style="vertical-align: middle;">The capital of France is Paris.</td>
</tr>
<tr>
<td style="vertical-align: middle;">What are some edible species of fish?</td>
<td style="vertical-align: middle;">There are many edible species of fish, including: 1. Tilapia - a
popular fish for both freshwater and saltwater environments. It's known
for its small size and easy to cook. 2. Cod - a large fish that can grow
to be over 20 pounds. It's often used in fish stew or as a main course.
3. Salmon - a fish that can be found in both freshwater and saltwater
environments. It's known for its rich, flavorful flesh and is often used
in fish tacos or as a main course. 4. Trout - a fish that can be fo
...... slightly sweet flavor and is often used in fish tacos or as a
main course. 8. Flounder - a fish that can be found in both freshwater
and saltwater environments. It's known for its mild, slightly sweet
flavor and is often used in fish tacos or as a main course. 9. Tilapia -
a popular fish for both freshwater and saltwater environments. It's
known for its small size and easy to cook. 10. Cod - a large fish that
can grow to be over 20 pounds. It's often used in fish stew or as a main
course.</td>
<td style="vertical-align: middle;">There are many edible species of fish, and the list can vary
depending on the region and personal preferences. Here are some popular
and commonly consumed edible fish species: 1. Salmon (Salmo salar):
Native to the Pacific coast of North America, salmon is a fatty fish
rich in omega-3 fatty acids and protein. 2. Tuna (Thunnus thynnus): A
popular species of fish, tuna is found in tropical and temperate waters
and is high in protein and low in fat. 3. Sardines (Sardinops
caeruleus): These s ...... icus): A mild-flavored fish, tilapia is
widely farmed and consumed in many parts of the world. 10. Shrimp
(Penaeus spp.): A popular seafood choice, shrimp is often cooked in a
variety of ways and is a good source of protein. Some other edible fish
species worth mentioning include: - Eel (Anguilla anguilla) - Perch
(Perca fluviatilis) - Trout (Oncorhynchus mykiss) - Bass (Micropterus
salmoides) - Herring (Clupea harengus) Remember to always check local
regulations and ensure that the fish</td>
</tr>
<tr>
<td style="vertical-align: middle;">Who are the most prominent classical composers?</td>
<td style="vertical-align: middle;">The most prominent classical composers include: 1. Ludwig van
Beethoven - known for his symphonies, piano sonatas, and operas 2.
Wolfgang Amadeus Mozart - known for his operas, symphonies, and chamber
music 3. Johann Sebastian Bach - known for his sacred works, concertos,
and fugues 4. Antonio Vivaldi - known for his concertos, string
quartets, and violin sonatas 5. Ludwig van Beethoven - known for his
symphonies, piano sonatas, and operas 6. George Frideric Handel - known
for his oratorios, operas, and string quartets 7. Johann Sebastian Bach
- known for his sacred works, concertos, and fugues 8. Antonio Vivaldi -
known for his concertos, string quartets, and violin sonatas 9. George
Frideric Handel - known for his oratorios, operas, and string quartets
10. Johann Sebastian Bach - known for his sacred works, concertos, and
fugues These composers have had a significant impact on the development
of classical music and continue to be studied and performed to this
day.</td>
<td style="vertical-align: middle;">Here's a list of some of the most prominent classical composers:
**Classical Period (1750-1820)** 1. Wolfgang Amadeus Mozart (1756-1791)
- Austrian composer known for his melodic genius and operas like 'The
Magic Flute.' 2. Ludwig van Beethoven (1770-1827) - German composer who
revolutionized classical music with his symphonies and piano sonatas. 3.
Antonio Vivaldi (1678-1741) - Italian composer and violinist famous for
his concertos, particularly 'The Four Seasons.' 4. Christoph Willibald
...... (1797-1828) - Austrian composer known for his melodic genius and
symphonies like 'Unfinished Symphony.' **Romantic Period (1820-1910)**
1. Franz Liszt (1811-1886) - Hungarian composer and pianist known for
his technical mastery and compositions like 'Hungarian Rhapsodies.' 2.
Robert Schumann (1810-1856) - German composer and pianist famous for his
symphonies, piano music, and songs like 'Carnaval.' 3. Pyotr Ilyich
Tchaikovsky (1840-1893) - Russian composer known for his ballets,
symphonies</td>
</tr>
</tbody>
</table>
`,`
<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th">input</th>
<th data-quarto-table-cell-role="th">output_teacher</th>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;">What is the capital of France?</td>
<td style="vertical-align: middle;">Bonjour! I'd be happy to explain it in a way that's easy to
understand. The capital of France is actually called Paris. It's a
beautiful city located in the north of France, and it's a very popular
tourist destination. Imagine you're in a big city, and you want to know
where the government is. That's kind of like what the capital is. It's
the city where the leaders of a country, like the president and the
prime minister, live and make important decisions. In this case, the
capital of France is Paris, and it's a very special place because it's
where many important events and decisions happen. Does that make
sense?</td>
</tr>
<tr>
<td style="vertical-align: middle;">What are some edible species of fish?</td>
<td style="vertical-align: middle;">Hello there, young learner! Today, we're going to talk about some
delicious and nutritious edible fish species. Don't worry, I'll explain
them in a way that's easy to understand. 1. **Salmon**: Salmon is a type
of fish that's rich in protein, omega-3 fatty acids, and vitamins. It's
a great source of energy and can help keep your heart healthy. You can
grill, bake, or sauté salmon for a tasty meal. 2. **Tuna**: Tuna is
another type of fish that's high in protein and low in fat. It's a great
...... thy bones. You can bake, fry, or make cod fish cakes for a tasty
meal. 5. **Shrimp**: Shrimp is a type of crustacean that's high in
protein and low in fat. It's a great source of vitamin B12, which is
essential for healthy red blood cells. You can boil, steam, or sauté
shrimp for a quick and easy meal. Remember, always ask a grown-up for
help when cooking fish, and make sure to handle and store fish safely to
avoid food poisoning. Which one of these fish species sounds interesting
to you?</td>
</tr>
<tr>
<td style="vertical-align: middle;">Who are the most prominent classical composers?</td>
<td style="vertical-align: middle;">As a patient teacher, I'd be happy to explain some of the most
prominent classical composers in a way that's easy to understand.
Classical music is a broad term that encompasses a wide range of styles
and periods. Here are some of the most famous and influential classical
composers: 1. **Wolfgang Amadeus Mozart** (1756-1791): Considered one of
the greatest composers of all time, Mozart wrote over 600 works,
including symphonies, operas, and chamber music. He's known for his
melodic and har ...... day. 5. **Pyotr Ilyich Tchaikovsky** (1840-1893):
A Russian composer, Tchaikovsky is known for his sweeping and emotive
symphonies, as well as his ballets, such as "Swan Lake". He's considered
one of the greatest composers of all time, and his music is still widely
performed today. 6. **Giuseppe Verdi** (1813-1901): An Italian composer,
Verdi is known for his dramatic and expressive operas, such as
"Rigoletto" and "Aida". He's considered one of the greatest opera
composers of all time, and</td>
</tr>
</tbody>
</table>
`];

This tutorial demonstrates how to use Pixeltable’s built-in `llama.cpp`
integration to run local LLMs efficiently.

### Important notes

-   Models are automatically downloaded from Hugging Face and cached
    locally
-   Different quantization levels are available for performance/quality
    tradeoffs
-   Consider memory usage when choosing models and quantizations

## Set up environment

First, let’s install Pixeltable with llama.cpp support:


```python
%pip install -qU pixeltable llama-cpp-python huggingface-hub
```

## Create a table for chat completions

Now let’s create a table that will contain our inputs and responses.


```python
import pixeltable as pxt
from pixeltable.functions import llama_cpp

pxt.drop_dir('llama_demo', force=True)
pxt.create_dir('llama_demo')

t = pxt.create_table('llama_demo/chat', {'input': pxt.String})
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Connected&nbsp;to&nbsp;Pixeltable&nbsp;database&nbsp;at:&nbsp;postgresql+psycopg://postgres:@/pixeltable?host=/Users/asiegel/.pixeltable/pgdata
Created&nbsp;directory&nbsp;&#x27;llama_demo&#x27;.
Created&nbsp;table&nbsp;&#x27;chat&#x27;.
</pre>

Next, we add a computed column that calls the Pixeltable
`create_chat_completion` UDF, which adapts the corresponding llama.cpp
API call. In our examples, we’ll use pretrained models from the Hugging
Face repository. llama.cpp makes it easy to do this by specifying a
repo_id (from the URL of the model) and filename from the model repo;
the model will then be downloaded and cached automatically.

(If this is your first time using Pixeltable, the
<a href="https://docs.pixeltable.com/tutorials/tables-and-data-operations">Pixeltable
Fundamentals</a> tutorial contains more details about table creation,
computed columns, and UDFs.)

For this demo we’ll use `Qwen2.5-0.5B`, a very small (0.5-billion
parameter) model that still produces decent results. We’ll use `Q5_K_M`
(5-bit) quantization, which gives an excellent balance of quality and
efficiency.


```python
# Add a computed column that uses llama.cpp for chat completion
# against the input.

messages = [
    {'role': 'system', 'content': 'You are a helpful assistant.'},
    {'role': 'user', 'content': t.input},
]

t.add_computed_column(
    result=llama_cpp.create_chat_completion(
        messages,
        repo_id='Qwen/Qwen2.5-0.5B-Instruct-GGUF',
        repo_filename='*q5_k_m.gguf',
    )
)

# Extract the output content from the JSON structure returned
# by llama_cpp.

t.add_computed_column(output=t.result.choices[0].message.content)
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Added&nbsp;0&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;0.01&nbsp;s
Added&nbsp;0&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;0.01&nbsp;s
No&nbsp;rows&nbsp;affected.
</pre>

## Test chat completion

Let’s try a simple query:


```python
# Test with a simple question
t.insert(
    [
        {'input': 'What is the capital of France?'},
        {'input': 'What are some edible species of fish?'},
        {'input': 'Who are the most prominent classical composers?'},
    ]
)
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Inserted&nbsp;3&nbsp;rows&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;6.74&nbsp;s&nbsp;(0.44&nbsp;rows/s)
3&nbsp;rows&nbsp;inserted.
</pre>


```python
t.select(t.input, t.output).collect()
```

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[0] }} />

## Comparing models

Local model frameworks like `llama.cpp` make it easy to compare the
output of different models. Let’s try comparing the output from `Qwen`
against a somewhat larger model, `Llama-3.2-1B`. As always, when we add
a new computed column to our table, it’s automatically evaluated against
the existing table rows.


```python
t.add_computed_column(
    result_l3=llama_cpp.create_chat_completion(
        messages,
        repo_id='bartowski/Llama-3.2-1B-Instruct-GGUF',
        repo_filename='*Q5_K_M.gguf',
    )
)

t.add_computed_column(output_l3=t.result_l3.choices[0].message.content)

t.select(t.input, t.output, t.output_l3).collect()
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Added&nbsp;3&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;6.32&nbsp;s&nbsp;(0.47&nbsp;rows/s)
Added&nbsp;3&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;0.03&nbsp;s&nbsp;(113.79&nbsp;rows/s)
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[1] }} />

Just for fun, let’s try running against a different system prompt with a
different persona.


```python
messages_teacher = [
    {
        'role': 'system',
        'content': 'You are a patient school teacher. '
        'Explain concepts simply and clearly.',
    },
    {'role': 'user', 'content': t.input},
]

t.add_computed_column(
    result_teacher=llama_cpp.create_chat_completion(
        messages_teacher,
        repo_id='bartowski/Llama-3.2-1B-Instruct-GGUF',
        repo_filename='*Q5_K_M.gguf',
    )
)

t.add_computed_column(
    output_teacher=t.result_teacher.choices[0].message.content
)

t.select(t.input, t.output_teacher).collect()
```

<pre style={{ 'margin': '-20px 20px 0px 20px', 'padding': '0px', 'background-color': 'transparent', 'color': 'black' }}>
Added&nbsp;3&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;7.70&nbsp;s&nbsp;(0.39&nbsp;rows/s)
Added&nbsp;3&nbsp;column&nbsp;values&nbsp;with&nbsp;0&nbsp;errors&nbsp;in&nbsp;0.02&nbsp;s&nbsp;(143.54&nbsp;rows/s)
</pre>

<div style={{ 'margin': '0px 20px 0px 20px' }} dangerouslySetInnerHTML={{ __html: quartoRawHtml[2] }} />

## Additional Resources

-   [Pixeltable Documentation](https:/docs.pixeltable.com/)
-   [llama.cpp GitHub](https://github.com/ggerganov/llama.cpp)
